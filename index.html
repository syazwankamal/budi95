<!DOCTYPE html>
<html lang="en">
<head>
<title>Budi95 Calculator - Petrol Subsidy vs Market Price Malaysia</title>
<meta name="description" content="Budi95 Calculator helps Malaysians understand petrol subsidy vs market price. Enter your RM amount and see litres at RM1.99 and real cost at live RON95 price.">
<meta name="keywords" content="Budi95, petrol calculator Malaysia, minyak subsidi, RON95 calculator, minyak RM50 berapa liter, harga pasaran minyak, ron95, minyak Malaysia">
<meta name="author" content="Mohamad Syazwan">
<meta property="og:title" content="Budi95 Calculator - Petrol Subsidy vs Market Price">
<meta property="og:description" content="Confused why your RM50 petrol shows higher value at the pump? Try this calculator.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://syazwankamal.github.io/budi95/">
<meta property="og:image" content="https://syazwankamal.github.io/budi95/screenshot.png">
<link rel="stylesheet" href="style.css">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9LG0S149PS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-9LG0S149PS');
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f5f7fa;
    color: #333;
  }

  header {
    background: #0066cc;
    color: #fff;
    padding: 20px;
    text-align: center;
  }

  .container {
    max-width: 500px;
    margin: 40px auto;
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.1);
  }

  h1 { margin: 0; font-size: 1.8em; }

  label {
    display: block;
    margin-bottom: 6px;
    font-weight: bold;
  }

  input[type="number"] {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 8px;
    margin-bottom: 15px;
    box-sizing: border-box;
  }

  button {
    background: #0066cc;
    color: #fff;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    width: 100%;
  }

  button:hover { background: #004d99; }

  .result {
    margin-top: 20px;
    padding: 15px;
    border-radius: 8px;
    background: #eaf3ff;
  }

  footer {
    text-align: center;
    margin: 30px 0;
    color: #777;
    font-size: 14px;
  }

  /* Collapsible */
  .collapsible {
    background-color: #0066cc;
    color: white;
    cursor: pointer;
    padding: 12px;
    border: none;
    text-align: left;
    outline: none;
    font-size: 16px;
    border-radius: 8px;
    width: 100%;
    margin-bottom: 10px;
  }

  .collapsible:hover { background-color: #004d99; }

  .content {
    padding: 0 15px;
    display: none;
    margin-bottom: 20px;
  }

  #updateDate {
    text-align: center;
    font-size: 14px;
    color: #555;
    margin-bottom: 8px;
  }

  #refreshBtn {
    display: block;
    margin: 0 auto 10px auto;
    background: #eee;
    color: #333;
    border: 1px solid #ccc;
    font-size: 13px;
    padding: 5px 10px;
    border-radius: 6px;
    cursor: pointer;
  }

  #refreshBtn:hover {
    background: #ddd;
  }

  /* Referral card */
  .referral-card {
    max-width: 500px;
    margin: 0 auto 40px auto;
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.1);
    text-align: center;
  }

  .referral-code {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    background: #f0f0f0;
    padding: 8px 12px;
    border-radius: 8px;
    font-weight: bold;
    margin: 10px 0;
  }

  .copy-icon {
    cursor: pointer;
    color: #0066cc;
  }

  .referral-btn {
    display: inline-block;
    background: #0066cc;
    color: white;
    padding: 10px 18px;
    border-radius: 8px;
    text-decoration: none;
  }

  .referral-btn:hover { background: #004d99; }
</style>
</head>
<body>
<header><h1>Budi95 Calculator</h1></header>

<div class="container">
  <button type="button" class="collapsible">⚙️ Set Prices</button>
  <div class="content">
    <form id="priceForm">
      <label for="subsidisedPrice">Subsidised price (RM/L):</label>
      <input type="number" id="subsidisedPrice" step="0.01" value="1.99" required>

      <label for="marketPrice">Market price (RM/L):</label>
      <input type="number" id="marketPrice" step="0.01" required>
      <p id="updateDate">Memuatkan tarikh kemas kini...</p>
      <button type="button" id="refreshBtn">↻ Kemas kini</button>
    </form>
  </div>

  <form id="calcForm">
    <label for="amount">Enter amount (RM):</label>
    <input type="number" id="amount" step="0.01" required placeholder="e.g. 50.00">
    <button type="submit">Calculate</button>
  </form>

  <div id="result" class="result" style="display:none;"></div>
</div>

<div class="referral-card">
  <h3>Save More with Setel</h3>
  <p>
    Buy <strong>RON95 @ RM<span id="fuel-price">1.99</span>/L</strong> with <strong>Setel</strong>. 
    Sign up with my referral code and we’ll both earn <strong>RM3</strong> after you spend RM30 on fuel or at Kedai Mesra.
  </p>

  <div class="referral-code">
    <span>Referral Code: <strong id="ref-code">erae</strong></span>
    <span id="copy-btn" class="copy-icon" title="Copy">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
           viewBox="0 0 24 24" fill="none" stroke="currentColor"
           stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </span>
  </div>

  <a href="https://www.setel.com/ref/erae" target="_blank" class="referral-btn">Sign Up on Setel</a>
</div>

<footer>&copy; 2025 Budi95 Calculator</footer>

<script>
// Collapsible toggle
document.querySelector(".collapsible").addEventListener("click", function() {
  this.classList.toggle("active");
  const content = this.nextElementSibling;
  content.style.display = content.style.display === "block" ? "none" : "block";
});

// Calculator logic
document.getElementById("calcForm").addEventListener("submit", function(e) {
  e.preventDefault();
  const amount = parseFloat(document.getElementById("amount").value);
  const subsidisedPrice = parseFloat(document.getElementById("subsidisedPrice").value);
  const marketPrice = parseFloat(document.getElementById("marketPrice").value);
  if (isNaN(amount) || amount <= 0) return;
  const litres = amount / subsidisedPrice;
  const realCost = litres * marketPrice;
  const resultDiv = document.getElementById("result");
  resultDiv.style.display = "block";
  resultDiv.innerHTML = `
    <p><strong>Amount entered:</strong> RM${amount.toFixed(2)}</p>
    <p><strong>Litres received (at RM${subsidisedPrice.toFixed(2)}):</strong> ${litres.toFixed(3)} L</p>
    <p><strong>Real cost shown at pump (at RM${marketPrice.toFixed(2)}):</strong> RM${realCost.toFixed(2)}</p>
  `;
});

// Copy referral code
const copyBtn = document.getElementById("copy-btn");
const refCode = document.getElementById("ref-code");
copyBtn.addEventListener("click", () => {
  navigator.clipboard.writeText(refCode.textContent).then(() => {
    copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';
    setTimeout(() => location.reload(), 1500);
  });
});

// ===== Fetch RON95 price with 24-hour caching =====
async function loadPetrolData(forceRefresh = false) {
  const cacheKey = "petrolData";
  const cached = localStorage.getItem(cacheKey);
  const oneDay = 24 * 60 * 60 * 1000;

  if (cached && !forceRefresh) {
    const data = JSON.parse(cached);
    if (Date.now() - data.timestamp < oneDay) {
      applyPetrolData(data);
      return;
    }
  }

  try {
    const response = await fetch("https://api.data.gov.my/data-catalogue/?id=fuelprice");
    const result = await response.json();
    const ron95 = result.data?.RON95?.price;
    const date = result.data?.RON95?.date;

    if (ron95 && date) {
      const newData = { ron95, date, timestamp: Date.now() };
      localStorage.setItem(cacheKey, JSON.stringify(newData));
      applyPetrolData(newData);
    } else {
      showError();
    }
  } catch {
    showError();
  }
}

function applyPetrolData(data) {
  document.getElementById("marketPrice").value = data.ron95.toFixed(2);
  document.getElementById("updateDate").textContent = `Tarikh kemas kini: ${data.date}`;
  localStorage.setItem("marketPrice", data.ron95);
}

function showError() {
  document.getElementById("updateDate").textContent = "Tidak dapat memuatkan tarikh kemas kini.";
}

document.getElementById("refreshBtn").addEventListener("click", () => {
  localStorage.removeItem("petrolData");
  loadPetrolData(true);
});

loadPetrolData();
</script>
</body>
</html>
